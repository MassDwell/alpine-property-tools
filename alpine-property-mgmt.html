<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Property Manager | Alpine Property Group</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="alpine-shared.js"></script>
  <link rel="stylesheet" href="alpine-premium.css">
  <style>
    .property-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .property-card {
      background: linear-gradient(to bottom, #ffffff 0%, #fafbfc 100%);
      border-radius: var(--radius-xl);
      padding: 24px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--gray-200);
      transition: all var(--transition-base);
      cursor: pointer;
    }

    .property-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .property-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .property-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-900);
      margin-bottom: 4px;
    }

    .property-address {
      font-size: 14px;
      color: var(--gray-600);
    }

    .occupancy-badge {
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 600;
    }

    .occupancy-high {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success-500);
    }

    .occupancy-medium {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning-500);
    }

    .occupancy-low {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger-500);
    }

    .property-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--gray-200);
    }

    .stat-item {
      text-align: center;
    }

    .stat-item-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-700);
    }

    .stat-item-label {
      font-size: 12px;
      color: var(--gray-600);
      margin-top: 4px;
    }

    .units-list {
      background: linear-gradient(to bottom, #ffffff 0%, #fafbfc 100%);
      border-radius: var(--radius-xl);
      padding: 28px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--gray-200);
    }

    .unit-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 16px;
      padding: 16px;
      background: var(--gray-50);
      border-radius: var(--radius-md);
      margin-bottom: 12px;
      align-items: center;
      transition: all var(--transition-base);
    }

    .unit-row:hover {
      background: var(--gray-100);
      box-shadow: var(--shadow-sm);
    }

    .unit-number {
      font-weight: 700;
      color: var(--primary-800);
    }

    .unit-status {
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
    }

    .status-occupied {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success-500);
    }

    .status-vacant {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger-500);
    }

    @media (max-width: 768px) {
      .property-grid {
        grid-template-columns: 1fr;
      }

      .unit-row {
        grid-template-columns: 1fr;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [properties, setProperties] = useState([]);
      const [selectedProperty, setSelectedProperty] = useState(null);
      const [showModal, setShowModal] = useState(false);

      useEffect(() => {
        loadData();
      }, []);

      const loadData = () => {
        let propertyData = AlpineData.getAll(AlpineData.KEYS.PROPERTIES);
        
        // Initialize with sample data if empty
        if (propertyData.length === 0) {
          propertyData = [
            {
              id: '1',
              name: 'Riverside Apartments',
              address: '123 River St, Boston, MA',
              totalUnits: 24,
              units: generateSampleUnits(24)
            },
            {
              id: '2',
              name: 'Oak Street Residences',
              address: '456 Oak Ave, Cambridge, MA',
              totalUnits: 12,
              units: generateSampleUnits(12)
            }
          ];
          AlpineData.save(AlpineData.KEYS.PROPERTIES, propertyData);
        }
        
        setProperties(propertyData);
      };

      const generateSampleUnits = (count) => {
        const units = [];
        for (let i = 1; i <= count; i++) {
          units.push({
            id: i.toString(),
            unitNumber: `${Math.floor((i-1)/6) + 1}${String.fromCharCode(65 + (i-1)%6)}`,
            bedrooms: [1, 2, 2, 3][Math.floor(Math.random() * 4)],
            rent: 2000 + Math.floor(Math.random() * 1500),
            status: Math.random() > 0.15 ? 'occupied' : 'vacant',
            tenant: Math.random() > 0.15 ? 'Tenant ' + i : null,
            leaseEnd: Math.random() > 0.15 ? '2026-12-31' : null
          });
        }
        return units;
      };

      const calculateOccupancy = (property) => {
        const occupied = property.units.filter(u => u.status === 'occupied').length;
        return property.totalUnits > 0 ? (occupied / property.totalUnits) : 0;
      };

      const calculateMonthlyIncome = (property) => {
        return property.units
          .filter(u => u.status === 'occupied')
          .reduce((sum, u) => sum + (u.rent || 0), 0);
      };

      const getOccupancyClass = (rate) => {
        if (rate >= 0.9) return 'occupancy-high';
        if (rate >= 0.75) return 'occupancy-medium';
        return 'occupancy-low';
      };

      const handlePropertyClick = (property) => {
        setSelectedProperty(property);
      };

      const totalUnits = properties.reduce((sum, p) => sum + p.totalUnits, 0);
      const totalOccupied = properties.reduce((sum, p) => 
        sum + p.units.filter(u => u.status === 'occupied').length, 0
      );
      const totalIncome = properties.reduce((sum, p) => sum + calculateMonthlyIncome(p), 0);
      const avgOccupancy = totalUnits > 0 ? (totalOccupied / totalUnits) : 0;

      return (
        <div className="container">
          <div className="header">
            <h1>üè¢ Property Manager</h1>
            <div className="nav-buttons">
              <a href="index.html" className="btn btn-secondary">üè† Home</a>
              {selectedProperty && (
                <button className="btn btn-secondary" onClick={() => setSelectedProperty(null)}>
                  ‚Üê Back to Portfolio
                </button>
              )}
            </div>
          </div>

          <div className="stats-grid">
            <div className="stat-card">
              <div className="stat-value">{properties.length}</div>
              <div className="stat-label">Properties</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{totalUnits}</div>
              <div className="stat-label">Total Units</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{AlpineData.formatPercent(avgOccupancy)}</div>
              <div className="stat-label">Portfolio Occupancy</div>
            </div>
            <div className="stat-card">
              <div className="stat-value">{AlpineData.formatCurrency(totalIncome)}</div>
              <div className="stat-label">Monthly Income</div>
            </div>
          </div>

          {!selectedProperty ? (
            <div className="property-grid">
              {properties.map(property => {
                const occupancy = calculateOccupancy(property);
                const monthlyIncome = calculateMonthlyIncome(property);
                const occupied = property.units.filter(u => u.status === 'occupied').length;

                return (
                  <div
                    key={property.id}
                    className="property-card"
                    onClick={() => handlePropertyClick(property)}
                  >
                    <div className="property-header">
                      <div>
                        <div className="property-name">{property.name}</div>
                        <div className="property-address">{property.address}</div>
                      </div>
                      <div className={`occupancy-badge ${getOccupancyClass(occupancy)}`}>
                        {Math.round(occupancy * 100)}%
                      </div>
                    </div>
                    <div className="property-stats">
                      <div className="stat-item">
                        <div className="stat-item-value">{occupied}/{property.totalUnits}</div>
                        <div className="stat-item-label">Units Occupied</div>
                      </div>
                      <div className="stat-item">
                        <div className="stat-item-value">{AlpineData.formatCurrency(monthlyIncome)}</div>
                        <div className="stat-item-label">Monthly Income</div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          ) : (
            <div className="units-list">
              <h2 style={{marginBottom: '24px', color: 'var(--primary-900)'}}>
                {selectedProperty.name} - Units
              </h2>
              {selectedProperty.units.map(unit => (
                <div key={unit.id} className="unit-row">
                  <div>
                    <div className="unit-number">Unit {unit.unitNumber}</div>
                    <div style={{fontSize: '13px', color: 'var(--gray-600)'}}>
                      {unit.bedrooms} BR
                    </div>
                  </div>
                  <div>
                    <div style={{fontWeight: 600, color: 'var(--primary-700)'}}>
                      {AlpineData.formatCurrency(unit.rent)}/mo
                    </div>
                  </div>
                  <div>
                    <span className={`unit-status status-${unit.status}`}>
                      {unit.status}
                    </span>
                  </div>
                  <div style={{fontSize: '13px', color: 'var(--gray-600)'}}>
                    {unit.tenant || '‚Äî'}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
  <!-- Authentication -->
  <script src="auth.js"></script>
  <script>
    requireAuth();
    window.addEventListener('DOMContentLoaded', () => { addLogoutButton(); });
  </script>
</body>
</html>
