<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Budget & Cost Tracker - Alpine Property Group</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #F7F8FA;
      color: #2D3748;
      line-height: 1.6;
    }

    .header {
      background: white;
      border-bottom: 1px solid #E2E8F0;
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 20px;
      font-weight: 700;
      color: #1A1A1A;
    }

    .logout-btn {
      background: #000;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .logout-btn:hover {
      background: #2D3748;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .project-header {
      background: white;
      padding: 30px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .project-header h1 {
      font-size: 28px;
      color: #1A1A1A;
      margin-bottom: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .stat-card {
      padding: 16px;
      background: #F7F8FA;
      border-radius: 6px;
    }

    .stat-label {
      font-size: 13px;
      color: #64748B;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 600;
      color: #1A1A1A;
    }

    .category-section {
      background: white;
      padding: 30px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      cursor: pointer;
      user-select: none;
    }

    .category-title {
      font-size: 20px;
      font-weight: 600;
      color: #1A1A1A;
    }

    .category-toggle {
      font-size: 18px;
      color: #64748B;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    thead {
      background: #F7F8FA;
      border-bottom: 2px solid #E2E8F0;
    }

    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #64748B;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    tbody tr {
      border-bottom: 1px solid #E2E8F0;
    }

    tbody tr:hover {
      background: #FAFAFA;
    }

    td {
      padding: 16px 12px;
      color: #2D3748;
    }

    .editable {
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.15s;
    }

    .editable:hover {
      background: #F1F3F5;
    }

    .editable:focus {
      outline: 2px solid #000;
      background: white;
    }

    .delete-btn {
      background: none;
      border: none;
      color: #64748B;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 16px;
      opacity: 0;
      transition: opacity 0.15s;
    }

    tr:hover .delete-btn {
      opacity: 1;
    }

    .delete-btn:hover {
      background: #FEE;
      color: #E53E3E;
    }

    .add-btn {
      background: #000;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-top: 12px;
    }

    .add-btn:hover {
      background: #2D3748;
    }

    .subcategory-row {
      background: #FAFAFA;
      font-weight: 600;
    }

    .subcategory-row td {
      padding: 12px;
      color: #1A1A1A;
    }

    .variance-positive {
      color: #059669;
    }

    .variance-negative {
      color: #DC2626;
    }

    .totals-row {
      background: #F7F8FA;
      font-weight: 700;
      border-top: 2px solid #E2E8F0;
    }

    .totals-row td {
      padding: 16px 12px;
      color: #1A1A1A;
    }

    .notes-icon {
      cursor: pointer;
      font-size: 16px;
      color: #64748B;
    }

    .notes-icon:hover {
      color: #1A1A1A;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">‚õ∞Ô∏è Alpine Property Group</div>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <div class="container">
    <div class="project-header">
      <h1 id="projectName">Project Budget & Cost Tracker</h1>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Budgeted</div>
          <div class="stat-value" id="totalBudgeted">$0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Actual</div>
          <div class="stat-value" id="totalActual">$0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Variance</div>
          <div class="stat-value" id="totalVariance">$0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">% Complete</div>
          <div class="stat-value" id="percentComplete">0%</div>
        </div>
      </div>
    </div>

    <div class="category-section" id="hardCosts">
      <div class="category-header" onclick="toggleCategory('hardCosts')">
        <h2 class="category-title">Hard Costs</h2>
        <span class="category-toggle">‚ñº</span>
      </div>
      <div class="category-content">
        <table>
          <thead>
            <tr>
              <th style="width: 30%">Line Item</th>
              <th style="width: 15%">Estimated</th>
              <th style="width: 10%">% of Project</th>
              <th style="width: 15%">Actual</th>
              <th style="width: 12%">Variance ($)</th>
              <th style="width: 10%">Variance (%)</th>
              <th style="width: 5%">Notes</th>
              <th style="width: 3%"></th>
            </tr>
          </thead>
          <tbody id="hardCostsBody">
            <!-- Line items will be rendered here -->
          </tbody>
        </table>
        <button class="add-btn" onclick="addLineItem('hard')">+ Add Line Item</button>
      </div>
    </div>

    <div class="category-section" id="softCosts">
      <div class="category-header" onclick="toggleCategory('softCosts')">
        <h2 class="category-title">Soft Costs</h2>
        <span class="category-toggle">‚ñº</span>
      </div>
      <div class="category-content">
        <table>
          <thead>
            <tr>
              <th style="width: 30%">Line Item</th>
              <th style="width: 15%">Estimated</th>
              <th style="width: 10%">% of Project</th>
              <th style="width: 15%">Actual</th>
              <th style="width: 12%">Variance ($)</th>
              <th style="width: 10%">Variance (%)</th>
              <th style="width: 5%">Notes</th>
              <th style="width: 3%"></th>
            </tr>
          </thead>
          <tbody id="softCostsBody">
            <!-- Line items will be rendered here -->
          </tbody>
        </table>
        <button class="add-btn" onclick="addLineItem('soft')">+ Add Line Item</button>
      </div>
    </div>
  </div>

  <script>
    // Default template data
    const defaultHardCosts = [
      'Land Acquisition',
      'Demolition',
      'Site Prep',
      'Foundation',
      'Framing',
      'Roofing',
      'Exterior Finishes',
      'Windows & Doors',
      'Plumbing',
      'HVAC',
      'Electrical',
      'Interior Finishes',
      'Flooring',
      'Kitchen & Bath',
      'Elevators'
    ];

    const defaultSoftCosts = [
      'Architecture & Design',
      'Engineering',
      'Legal Fees',
      'Permits & Fees',
      'Insurance',
      'Financing Costs',
      'Marketing',
      'Accounting',
      'Developer Fee',
      'Contingency'
    ];

    let projectData = {
      hardCosts: [],
      softCosts: []
    };

    // Initialize
    function init() {
      loadData();
      if (projectData.hardCosts.length === 0) {
        // First time - create default template
        projectData.hardCosts = defaultHardCosts.map((name, i) => ({
          id: `hard-${i}`,
          name,
          estimated: 0,
          actual: 0,
          notes: ''
        }));
        projectData.softCosts = defaultSoftCosts.map((name, i) => ({
          id: `soft-${i}`,
          name,
          estimated: 0,
          actual: 0,
          notes: ''
        }));
        saveData();
      }
      render();
    }

    function loadData() {
      const saved = localStorage.getItem('alpineBudgetData');
      if (saved) {
        projectData = JSON.parse(saved);
      }
    }

    function saveData() {
      localStorage.setItem('alpineBudgetData', JSON.stringify(projectData));
      updateTotals();
    }

    function render() {
      renderCategory('hardCosts', projectData.hardCosts);
      renderCategory('softCosts', projectData.softCosts);
      updateTotals();
    }

    function renderCategory(category, items) {
      const tbody = document.getElementById(`${category}Body`);
      tbody.innerHTML = '';

      items.forEach((item, index) => {
        const variance = item.actual - item.estimated;
        const variancePct = item.estimated > 0 ? ((variance / item.estimated) * 100).toFixed(1) : 0;
        const pctOfProject = calculatePctOfProject(item.estimated);

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div class="editable" contenteditable="true" 
                 onblur="updateField('${category}', ${index}, 'name', this.textContent)"
                 onkeydown="handleEnter(event)">${item.name}</div>
          </td>
          <td>
            <div class="editable" contenteditable="true" 
                 onblur="updateField('${category}', ${index}, 'estimated', this.textContent)"
                 onkeydown="handleEnter(event)">$${formatNumber(item.estimated)}</div>
          </td>
          <td>${pctOfProject}%</td>
          <td>
            <div class="editable" contenteditable="true" 
                 onblur="updateField('${category}', ${index}, 'actual', this.textContent)"
                 onkeydown="handleEnter(event)">$${formatNumber(item.actual)}</div>
          </td>
          <td class="${variance >= 0 ? 'variance-positive' : 'variance-negative'}">
            $${formatNumber(Math.abs(variance))} ${variance >= 0 ? '‚¨Ü' : '‚¨á'}
          </td>
          <td class="${variance >= 0 ? 'variance-positive' : 'variance-negative'}">
            ${variancePct}%
          </td>
          <td>
            <span class="notes-icon" onclick="editNotes('${category}', ${index})">
              ${item.notes ? 'üìù' : 'üìÑ'}
            </span>
          </td>
          <td>
            <button class="delete-btn" onclick="deleteItem('${category}', ${index})">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Add totals row
      const totals = calculateCategoryTotals(items);
      const totalRow = document.createElement('tr');
      totalRow.className = 'totals-row';
      totalRow.innerHTML = `
        <td>Total</td>
        <td>$${formatNumber(totals.estimated)}</td>
        <td>100%</td>
        <td>$${formatNumber(totals.actual)}</td>
        <td>$${formatNumber(Math.abs(totals.variance))}</td>
        <td>${totals.variancePct}%</td>
        <td></td>
        <td></td>
      `;
      tbody.appendChild(totalRow);
    }

    function updateField(category, index, field, value) {
      const cleanValue = value.replace(/[$,]/g, '').trim();
      
      if (field === 'estimated' || field === 'actual') {
        projectData[category][index][field] = parseFloat(cleanValue) || 0;
      } else {
        projectData[category][index][field] = cleanValue;
      }
      
      saveData();
      render();
    }

    function deleteItem(category, index) {
      if (confirm('Delete this line item?')) {
        projectData[category].splice(index, 1);
        saveData();
        render();
      }
    }

    function addLineItem(type) {
      const category = type === 'hard' ? 'hardCosts' : 'softCosts';
      const name = prompt('Enter line item name:');
      if (name) {
        projectData[category].push({
          id: `${type}-${Date.now()}`,
          name: name,
          estimated: 0,
          actual: 0,
          notes: ''
        });
        saveData();
        render();
      }
    }

    function editNotes(category, index) {
      const item = projectData[category][index];
      const notes = prompt('Enter notes:', item.notes || '');
      if (notes !== null) {
        item.notes = notes;
        saveData();
        render();
      }
    }

    function calculateCategoryTotals(items) {
      const estimated = items.reduce((sum, item) => sum + item.estimated, 0);
      const actual = items.reduce((sum, item) => sum + item.actual, 0);
      const variance = actual - estimated;
      const variancePct = estimated > 0 ? ((variance / estimated) * 100).toFixed(1) : 0;
      return { estimated, actual, variance, variancePct };
    }

    function calculatePctOfProject(amount) {
      const total = getTotalBudget();
      return total > 0 ? ((amount / total) * 100).toFixed(1) : 0;
    }

    function getTotalBudget() {
      const hardTotal = projectData.hardCosts.reduce((sum, item) => sum + item.estimated, 0);
      const softTotal = projectData.softCosts.reduce((sum, item) => sum + item.estimated, 0);
      return hardTotal + softTotal;
    }

    function updateTotals() {
      const hardTotals = calculateCategoryTotals(projectData.hardCosts);
      const softTotals = calculateCategoryTotals(projectData.softCosts);
      
      const totalBudgeted = hardTotals.estimated + softTotals.estimated;
      const totalActual = hardTotals.actual + softTotals.actual;
      const totalVariance = totalActual - totalBudgeted;
      const percentComplete = totalBudgeted > 0 ? ((totalActual / totalBudgeted) * 100).toFixed(1) : 0;

      document.getElementById('totalBudgeted').textContent = '$' + formatNumber(totalBudgeted);
      document.getElementById('totalActual').textContent = '$' + formatNumber(totalActual);
      document.getElementById('totalVariance').textContent = '$' + formatNumber(Math.abs(totalVariance));
      document.getElementById('percentComplete').textContent = percentComplete + '%';
    }

    function toggleCategory(id) {
      const section = document.getElementById(id);
      const content = section.querySelector('.category-content');
      const toggle = section.querySelector('.category-toggle');
      
      if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.textContent = '‚ñº';
      } else {
        content.style.display = 'none';
        toggle.textContent = '‚ñ∂';
      }
    }

    function handleEnter(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        e.target.blur();
      }
    }

    function formatNumber(num) {
      return num.toLocaleString('en-US', { maximumFractionDigits: 0 });
    }

    function logout() {
      sessionStorage.removeItem('alpineAuth');
      window.location.href = 'login.html';
    }

    // Check auth
    const auth = sessionStorage.getItem('alpineAuth');
    if (!auth) {
      window.location.href = 'login.html';
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
